<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <title>Live Stream</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body, html {
      height: 100%;
      background: #000;
      overflow: hidden;
      position: fixed;
      width: 100%;
    }
    #videoPlayer {
      width: 100vw;
      height: 100vh;
      object-fit: contain;
      background: #000;
    }
    .play-button {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: rgba(0,0,0,0.7);
      color: white;
      border: none;
      border-radius: 50%;
      width: 80px;
      height: 80px;
      font-size: 30px;
      cursor: pointer;
      z-index: 10;
      display: none;
    }
    .play-button:hover { background: rgba(0,0,0,0.9); }
    .loading {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      color: white;
      font-size: 18px;
      z-index: 5;
    }
    /* N√∫t b·∫≠t/t·∫Øt ti·∫øng */
    .mute-button {
      position: absolute;
      bottom: 10px;       /* t·ª•t xu·ªëng th·∫•p h∆°n */
      right: 50px;        /* sang tr√°i 1 ch√∫t (ti·∫øn v·ªÅ gi·ªØa) */
      background: transparent;
      color: white;
      border: none;
      border-radius: 50%; /* h√¨nh tr√≤n */
      width: 40px;        /* nh·ªè l·∫°i */
      height: 40px;
      font-size: 13px;    /* icon nh·ªè h∆°n */
      cursor: pointer;
      z-index: 10;
      display: none;      /* ch·ªâ hi·ªán khi video ch·∫°y */
    }

  </style>
</head>
<body>
  <div class="loading" id="loading">ƒêang t·∫£i stream...</div>
  <button class="play-button" id="playButton" onclick="playVideo()">‚ñ∂</button>
  <button class="mute-button" id="muteButton">üîá</button>

  <video id="videoPlayer" muted autoplay playsinline webkit-playsinline>
    <source src="/hls/live.m3u8" type="application/x-mpegURL">
    Your browser does not support the video tag.
  </video>

  <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
  <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
  <script>
    const video = document.getElementById('videoPlayer');
    const videoSrc = '/hls/live.m3u8';
    const loading = document.getElementById('loading');
    const playButton = document.getElementById('playButton');
    const muteButton = document.getElementById('muteButton');

    function playVideo() {
      playButton.style.display = 'none';
      video.play().then(() => {
        muteButton.style.display = 'block'; // hi·ªán n√∫t √¢m thanh
      }).catch(e => {
        console.log('Autoplay prevented:', e);
        playButton.style.display = 'block';
      });
    }

    function hideLoading() { loading.style.display = 'none'; }

    // N√∫t b·∫≠t/t·∫Øt ti·∫øng
    muteButton.addEventListener('click', () => {
      video.muted = !video.muted;
      muteButton.textContent = video.muted ? 'üîá' : 'üîä';
    });

    // Detect mobile device
    const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);

    if (Hls.isSupported()) {
      const hls = new Hls({
        liveSyncDurationCount: 1,
        liveMaxLatencyDurationCount: 3,
        debug: false,
        enableWorker: true,
        lowLatencyMode: true
      });
      hls.loadSource(videoSrc);
      hls.attachMedia(video);
      hls.on(Hls.Events.MANIFEST_PARSED, function() {
        hideLoading();
        video.play().then(() => {
          muteButton.style.display = 'block'; // hi·ªán n√∫t √¢m thanh khi ph√°t ƒë∆∞·ª£c
        }).catch(e => {
          console.log('Autoplay prevented:', e);
          if (isMobile) playButton.style.display = 'block';
        });
      });
      hls.on(Hls.Events.ERROR, function (event, data) {
        console.error('HLS error:', data);
        if (data.fatal) {
          switch(data.type) {
            case Hls.ErrorTypes.NETWORK_ERROR: hls.startLoad(); break;
            case Hls.ErrorTypes.MEDIA_ERROR: hls.recoverMediaError(); break;
            default: hls.destroy(); break;
          }
        }
      });
    } else if (video.canPlayType('application/vnd.apple.mpegurl')) {
      video.src = videoSrc;
      video.addEventListener('loadedmetadata', function() {
        hideLoading();
        video.play().then(() => {
          muteButton.style.display = 'block';
        }).catch(e => {
          console.log('Autoplay prevented:', e);
          if (isMobile) playButton.style.display = 'block';
        });
      });
      video.addEventListener('error', function() {
        hideLoading();
        playButton.style.display = 'block';
      });
    } else {
      hideLoading();
      playButton.style.display = 'block';
    }

    // Pause khi tab kh√¥ng hi·ªÉn th·ªã
    document.addEventListener('visibilitychange', function() {
      if (document.hidden) {
        video.pause();
      } else {
        video.play().catch(e => console.log('Resume play prevented:', e));
      }
    });

    // Gi·ªØ inline tr√™n mobile
    video.addEventListener('play', function() {
      if (isMobile) {
        video.setAttribute('playsinline', 'true');
        video.setAttribute('webkit-playsinline', 'true');
      }
    });
  </script>
</body>
</html>